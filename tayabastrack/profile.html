<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>User Profile with Events</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, sans-serif; display: flex; min-height: 100vh; background: #f5f7fb; color: #333; }

    /* Sidebar */
    .sidebar { width: 240px; background: #004aad; color: #fff; display: flex; flex-direction: column; justify-content: space-between; padding: 1rem 0; }
    .sidebar-header { display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 2rem; }
    .sidebar-header img { width: 40px; }
    .sidebar-header h2 { font-size: 1.2rem; margin: 0; }
    .sidebar-menu { list-style: none; }
    .sidebar-menu li { margin: 0.5rem 0; }
    .sidebar-menu a { display: flex; align-items: center; gap: 10px; padding: 0.8rem 1.5rem; text-decoration: none; color: #fff; transition: background 0.3s; }
    .sidebar-menu li.active a, .sidebar-menu a:hover { background: #0756cc; border-left: 4px solid #042f68; }
    .sidebar-footer {
      text-align: center; font-size: 0.85rem; padding: 1rem;
      border-top: 1px solid rgba(255,255,255,0.2);
    }
    /* Main */
    .main { flex: 1; display: flex; flex-direction: column; }
    .navbar { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 10; }
    .navbar h1 { font-size: 1.4rem; color: #004aad; }

    .profile { display: flex; align-items: center; gap: 1rem; position: relative; }
    .profile .fa-bell { font-size: 1.2rem; cursor: pointer; position: relative; }
    .badge { background: red; color: #fff; font-size: 0.7rem; border-radius: 50%; padding: 3px 6px; position: absolute; top: -8px; right: -8px; }
    .avatar { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; }
    .username { font-weight: 500; }

    /* Dropdown */
    .dropdown-menu { display: none; position: absolute; top: 50px; right: 0; background: #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.15); overflow: hidden; min-width: 130px; z-index: 100; }
    .dropdown-menu a { display: block; padding: 10px; text-decoration: none; color: #333; transition: background 0.3s; }
    .dropdown-menu a:hover { background: #f0f0f0; }

    /* Profile Page */
    .container { display: flex; flex-direction: column; padding: 1rem; }
    .profile-section { display: flex; gap: 1rem; align-items: flex-start; max-width: 1000px; width: 100%; margin: 0 auto; }
    .profile-card, .account-card { background: #fff; border-radius: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); padding: 1rem; flex: 1; }
    .profile-card img { width: 100px; height: 100px; border-radius: 50%; object-fit: cover; margin-bottom: 0.5rem; }
    .profile-info label { font-weight: bold; display: block; margin-top: 6px; font-size: 0.85rem; }
    .profile-info input { width: 100%; padding: 6px; border-radius: 6px; border: 1px solid #ccc; margin-top: 3px; font-size: 0.85rem; }
    .btn { background: #004aad; color: #fff; padding: 6px 12px; border: none; border-radius: 6px; margin-top: 0.8rem; cursor: pointer; font-size: 0.85rem; }
    .btn:hover { background: #003580; }

    /* Calendar */
    .calendar { margin-top: 1rem; }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
    .calendar-header button { background: #004aad; color: #fff; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8rem; }
    .calendar-header h3 { color: #004aad; }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; font-size: 0.8rem; }
    .calendar-grid div { padding: 8px; background: #f5f7fb; border-radius: 6px; cursor: pointer; position: relative; }
    .calendar-grid .today { background: #004aad; color: #fff; font-weight: bold; }
    .calendar-grid .has-event::after {
      content: "â€¢";
      color: red;
      font-size: 1.2rem;
      position: absolute;
      bottom: 2px;
      right: 6px;
    }

    /* Events List */
    .events-list { margin-top: 1rem; }
    .events-list h4 { color: #004aad; margin-bottom: 0.5rem; }
    .events-list ul { list-style: none; padding: 0; }
    .events-list li { background: #f0f4ff; margin-bottom: 6px; padding: 6px 10px; border-radius: 6px; font-size: 0.85rem; }

    /* Modal */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 1rem; border-radius: 10px; width: 350px; }
    .modal-content h2 { margin-bottom: 1rem; color: #004aad; font-size: 1.2rem; text-align: center; }
    .modal-content input { width: 100%; padding: 6px; margin-bottom: 0.8rem; border: 1px solid #ccc; border-radius: 6px; }
    .modal-events { max-height: 150px; overflow-y: auto; margin-bottom: 1rem; text-align: left; }
    .modal-events ul { list-style: none; padding: 0; }
    .modal-events li { background: #f0f4ff; margin-bottom: 6px; padding: 6px 10px; border-radius: 6px; font-size: 0.85rem; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div>
      <div class="sidebar-header">
        <img src="logu.png" alt="Logo" class="logo">
        <h2>TayabaStrack</h2>
      </div>
      <ul class="sidebar-menu">
        <li><a href="ad_dashboard.html"><i class="fa fa-home"></i> Dashboard</a></li>
        <li class="active"><a href="ad_reports.html"><i class="fa fa-tasks"></i> Manage Reports</a></li>
        <li><a href="ad_map.html"><i class="fa fa-map-marker-alt"></i> Map</a></li>
        <li><a href="ad_usermanagement.html"><i class="fa fa-users"></i> User Management</a></li>
        <li><a href="#"><i class="fa fa-bullhorn"></i> Report Bulletin</a></li>
      </ul>
    </div>
    <div class="sidebar-footer">
      <p>Logged in as:</p>
      <strong id="sidebarName">Loading...</strong><br>
      <span id="sidebarPosition">Loading...</span>
    </div>
  </aside>
  </aside>

  <!-- Main -->
  <main class="main">
    <!-- Navbar -->
    <nav class="navbar">
      <h1>User Profile</h1>
      <div class="profile">
        <div style="position: relative;">
          <i class="fa fa-bell"></i>
          <span class="badge">1</span>
        </div>
        <img src="mark.jpg" alt="Profile" class="avatar" onclick="toggleDropdown()">
        <div class="dropdown-menu" id="dropdownMenu">
          <a href="profile.html">Profile</a>
            <a href="logout.html"> Logout</a>
        </div>
          <span class="username" id="navUsername">Loading...</span>
      </div>
    </nav>

    <!-- Profile Content -->
    <div class="container">
      <div class="profile-section">
        <!-- Left -->
        <div class="profile-card">
          <img src="mark.jpg" alt="Profile Picture">
          <div class="profile-info">
            <label>Full Name</label>
            <input type="text" value="Mark Lee">
            <label>ID</label>
            <input type="text" value="12345">
            <label>Email</label>
            <input type="email" value="marklee@slsu.edu.ph">
            <label>Phone</label>
            <input type="text" value="09065429497">
            <label>Address</label>
            <input type="text" value="Wakas, Tayabas">
            <label>Gender</label>
            <input type="text" value="Male">
          </div>
          <button class="btn">Edit Profile</button>
        </div>

        <!-- Right -->
        <div class="account-card">
          <h2>Account Info</h2>
          <p><strong>Type:</strong> Super Admin</p>
          <p><strong>Registered:</strong> March 10, 2025</p>
          <p><strong>Last Login:</strong> April 23, 2024</p>

          <!-- Calendar -->
          <div class="calendar">
            <div class="calendar-header">
              <button onclick="prevMonth()">â€¹</button>
              <h3 id="monthYear"></h3>
              <button onclick="nextMonth()">â€º</button>
            </div>
            <div class="calendar-grid" id="calendarDays"></div>
          </div>

          <!-- Events Summary -->
          <div class="events-list">
            <h4>ðŸ“… Upcoming Events</h4>
            <ul id="eventsSummary">
              <li><em>No events yet. Add one by clicking a date.</em></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Event Modal -->
  <div class="modal" id="eventModal">
    <div class="modal-content">
      <h2 id="modalDate"></h2>
      <div class="modal-events">
        <ul id="dayEvents"></ul>
      </div>
      <input type="text" id="eventInput" placeholder="Enter event">
      <button class="btn" onclick="saveEvent()">Save Event</button>
    </div>
  </div>



<!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyB06vfES5thZQi3Yd11vkooHVH-d5d4Y3o",
      authDomain: "tayabastrack-23b95.firebaseapp.com",
      projectId: "tayabastrack-23b95",
      storageBucket: "tayabastrack-23b95.firebasestorage.app",
      messagingSenderId: "674055915366",
      appId: "1:674055915366:web:aa560336c1f8b504eeaaa7"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // Load user info into sidebar + navbar
    auth.onAuthStateChanged(user => {
      if (user) {
        db.collection("users").doc(user.uid).get().then(doc => {
          if (doc.exists) {
            const data = doc.data();
            document.getElementById("sidebarName").textContent = data.name || "No Name";
            document.getElementById("sidebarPosition").textContent = data.position || "No Position";
            document.getElementById("navUsername").textContent = data.name || "User";
          }
        });
      } else {
        window.location.href = "index.html"; // redirect if not logged in
      }
    });

    function toggleDropdown() {
      const menu = document.getElementById("dropdownMenu");
      menu.style.display = (menu.style.display === "block") ? "none" : "block";
    }
    window.addEventListener("click", function(e) {
      if (!e.target.matches(".avatar")) {
        document.getElementById("dropdownMenu").style.display = "none";
      }
    });

    // Calendar & Events
    const monthYear = document.getElementById("monthYear");
    const calendarDays = document.getElementById("calendarDays");
    const eventModal = document.getElementById("eventModal");
    const eventInput = document.getElementById("eventInput");
    const modalDate = document.getElementById("modalDate");
    const dayEvents = document.getElementById("dayEvents");
    const eventsSummary = document.getElementById("eventsSummary");
    let currentDate = new Date();
    let selectedDate = null;
    let events = JSON.parse(localStorage.getItem("events")) || {};

    function renderCalendar(date) {
      const year = date.getFullYear();
      const month = date.getMonth();
      const today = new Date();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      monthYear.textContent = date.toLocaleString("default", { month: "long", year: "numeric" });
      calendarDays.innerHTML = "";

      for (let i = 0; i < firstDay; i++) {
        calendarDays.innerHTML += `<div></div>`;
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${year}-${month + 1}-${day}`;
        const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
        const hasEvent = events[dateKey] && events[dateKey].length > 0;
        calendarDays.innerHTML += `<div class="${isToday ? "today" : ""} ${hasEvent ? "has-event" : ""}" onclick="openModal('${dateKey}')">${day}</div>`;
      }
    }

    function prevMonth() { currentDate.setMonth(currentDate.getMonth() - 1); renderCalendar(currentDate); updateEventsSummary(); }
    function nextMonth() { currentDate.setMonth(currentDate.getMonth() + 1); renderCalendar(currentDate); updateEventsSummary(); }

    function openModal(dateKey) {
      selectedDate = dateKey;
      modalDate.textContent = `Events for ${dateKey}`;
      eventInput.value = "";
      dayEvents.innerHTML = "";

      if (events[dateKey]) {
        events[dateKey].forEach(ev => {
          const li = document.createElement("li");
          li.textContent = ev;
          dayEvents.appendChild(li);
        });
      } else {
        dayEvents.innerHTML = "<li><em>No events yet.</em></li>";
      }

      eventModal.style.display = "flex";
    }

    function saveEvent() {
      if (!eventInput.value.trim()) return;
      if (!events[selectedDate]) events[selectedDate] = [];
      events[selectedDate].push(eventInput.value.trim());
      localStorage.setItem("events", JSON.stringify(events));
      eventModal.style.display = "none";
      renderCalendar(currentDate);
      updateEventsSummary();
    }

    function updateEventsSummary() {
      eventsSummary.innerHTML = "";
      const allEvents = [];

      for (const date in events) {
        events[date].forEach(ev => {
          allEvents.push({ date: new Date(date), text: ev });
        });
      }

      if (allEvents.length === 0) {
        eventsSummary.innerHTML = "<li><em>No events yet. Add one by clicking a date.</em></li>";
        return;
      }

      allEvents.sort((a, b) => a.date - b.date);
      allEvents.forEach(ev => {
        const li = document.createElement("li");
        li.textContent = `${ev.date.toDateString()} â€” ${ev.text}`;
        eventsSummary.appendChild(li);
      });
    }

    window.onclick = function(event) {
      if (event.target == eventModal) {
        eventModal.style.display = "none";
      }
    }

    renderCalendar(currentDate);
    updateEventsSummary();
  </script>
</body>
</html>
